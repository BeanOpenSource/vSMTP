/// an example with a code object accepting string interpolation.
fn retry_helo(helo) {
    obj::code(250, `cannot identify with '${helo}'.`);
}

#{
    helo: [
        rule "helo must be foo.bar" || {
            const helo = ctx::helo();
            if helo == "foo" {
                // using a code object to send an informative message.
                const foo_invalid = obj::code(
                    250,
                    "2.0.0",
                    "foo is not accepted as a helo value.",
                );

                state::info(foo_invalid);
            } else if helo == "bar" {
                const bar_invalid = obj::code(250, "I do not accept this email, sorry");

                state::info(bar_invalid);
            } else if helo == "example.com" {
                state::next()
            } else {
                state::info(retry_helo(helo));
            }
        },

        rule "helo trailing" || state::accept(),
    ],

    mail: [
        rule "retry mail" || {
            if ctx::mail_from().domain == "satan.org" {
                state::info("250 satan.org is not valid, please try again.");
            } else {
                state::accept()
            }
        }
    ],

    preq: [
        rule "cannot send data" || state::info("500 I decided that you cannot send data.")
    ],
}
